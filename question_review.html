<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Converted Component</title>
  <style>
    /* Base styles */
    :root {
      --primary-color: #6c5ce7;  /* Light purple */
      --secondary-color: #e8f1ff; /* Light blue */
      --accent-color: #4834d4;   /* Darker purple for hover states */
      --light-accent: #a29bfe;   /* Lighter purple */
      --text-color: #2d3436;
      --border-radius: 8px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      padding: var(--spacing-md);
      background-color: var(--secondary-color);
      color: var(--text-color);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-md);
    }

    /* Grid system */
    .grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    /* Card styles */
    .card {
      background-color: #ffffff;
      border: 1px solid rgba(108, 92, 231, 0.1);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.1);
      height: fit-content;
      min-height: 200px;
      overflow: hidden;
      width: 100%;
    }

    /* Calculator container */
    #calculator {
      width: 100%;
      height: 400px;
      border: none;
      margin-top: 16px;
    }

    /* Form elements */
    .input, .textarea {
      width: 100%;
      padding: var(--spacing-sm);
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-md);
      font-size: 14px;
    }

    .textarea {
      background-color: white;
      padding: 12px;
      transition: border-color 0.3s ease;
    }

    .textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      outline: none;
    }

    .textarea, #question, #explanation {
      font-size: 16px;
    }

    #question {
      height: 200px;
    }

    #explanation {
      height: 150px;
    }

    /* Answer options */
    .answer-options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .answer-option {
      background-color: var(--secondary-color);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      transition: all 0.2s ease;
    }

    .answer-option:hover {
      background-color: #eef2f7;
    }

    .answer-option label {
      font-weight: 500;
      color: #333;
      cursor: pointer;
      user-select: none;
    }

    .answer-option input[type="text"] {
      flex: 1;
      margin: 0;
      height: 40px;
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      padding: var(--spacing-sm);
      transition: all 0.2s ease;
    }

    .answer-option input[type="text"]:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      outline: none;
    }

    .answer-option input[type="radio"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      outline: none;
      margin-right: var(--spacing-sm);
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .answer-option input[type="radio"]:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .answer-option input[type="radio"]:checked::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: white;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .answer-option input[type="radio"]:hover {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
    }

    @media (hover: hover) {
      .answer-option:hover {
        transform: translateX(4px);
      }
    }

    @media (max-width: 768px) {
      .answer-option input[type="radio"] {
        width: 24px;
        height: 24px;
      }

      .answer-option input[type="radio"]:checked::after {
        width: 10px;
        height: 10px;
      }
    }

    /* Image preview */
    .image-preview-container {
      position: relative;
      margin-top: var(--spacing-md);
      display: none;
    }

    .image-preview-container.visible {
      display: block;
    }

    .image-preview-container img {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius);
    }

    /* Image remove button styling */
    .remove-image-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background-color: rgba(255, 68, 68, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .remove-image-btn:hover {
      background-color: rgb(255, 68, 68);
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .remove-image-btn:active {
      transform: scale(0.95);
    }

    .remove-image-btn i {
      font-size: 18px;
      line-height: 1;
    }

    /* Rating stars */
    .stars {
      display: flex;
      gap: var(--spacing-sm);
      margin: var(--spacing-md) 0;
    }

    .star {
      background: none;
      border: none;
      font-size: 24px;
      color: #ddd;
      cursor: pointer;
    }

    .star.rated {
      color: #ffd700;
    }

    /* Bottom section */
    .bottom-section {
      margin-top: var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .rating-container, .review-section {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: 1fr;
      }

      .bottom-section {
        flex-direction: column;
        align-items: stretch;
      }

      .rating-container, .review-section {
        flex-direction: column;
        align-items: stretch;
      }

      .card {
        padding: var(--spacing-md);
      }

      .answer-option {
        flex-wrap: wrap;
      }

      .answer-option input[type="text"] {
        width: 100%;
        margin-top: var(--spacing-sm);
      }

      .stars {
        justify-content: center;
      }

      .button {
        width: 100%;
        margin-top: var(--spacing-sm);
      }

      #question {
        height: 250px;
      }

      #explanation {
        height: 200px;
      }

      #calculator {
        height: 350px;
      }

      .answer-option input[type="text"] {
        height: 44px;
        font-size: 16px;
      }

      #openAnswerSection .open-answer textarea {
        height: 120px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: var(--spacing-sm);
      }

      .container {
        padding: var(--spacing-sm);
      }

      .card {
        padding: var(--spacing-sm);
      }

      .stars {
        flex-wrap: wrap;
      }

      .input, .textarea {
        font-size: 16px; /* Prevents zoom on mobile */
      }
    }

    /* Switch styles */
    .switch-container {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin: var(--spacing-md) 0;
    }

    input[type="checkbox"] {
      margin-right: var(--spacing-sm);
    }

    /* Confirmation section */
    .confirmation {
      margin: var(--spacing-lg) 0;
    }

    .warning {
      color: #ff4444;
      font-size: 14px;
      margin: var(--spacing-sm) 0;
    }

    /* Open answer styling */
    .open-answer {
      background-color: var(--secondary-color);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-md);
      transition: all 0.2s ease;
    }

    .open-answer:hover {
      background-color: #eef2f7;
    }

    .open-answer textarea {
      width: 100%;
      height: 100px;
      padding: var(--spacing-sm);
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      background-color: white;
      resize: none;
      transition: all 0.2s ease;
    }

    .open-answer textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      outline: none;
    }

    .open-answer label {
      display: block;
      font-weight: 500;
      color: #333;
      margin-bottom: var(--spacing-sm);
    }

    /* Question type toggle styling */
    .question-type-toggle {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-md);
      background-color: var(--secondary-color);
      border-radius: var(--border-radius);
    }

    .question-type-toggle label {
      font-weight: 500;
      color: #333;
      cursor: pointer;
      user-select: none;
    }

    .question-type-toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: var(--spacing-sm);
    }

    /* Image upload section styling */
    .image-upload-container {
      height: 0;
      overflow: hidden;
      opacity: 0;
      transition: height 0.3s ease-out, opacity 0.3s ease-out;
    }

    .image-upload-container.expanded {
      height: auto;
      opacity: 1;
    }

    .image-preview-container {
      position: relative;
      margin-top: var(--spacing-md);
    }

    #imagePreview {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius);
      display: none;
    }

    #imagePreview.visible {
      display: block;
    }

    #imagePreview img {
      max-width: 100%;
      height: auto;
      max-height: none;
      border-radius: var(--border-radius);
    }

    .image-upload-button {
      display: none;
    }

    .image-upload-button.visible {
      display: inline-block;
    }

    /* Enhanced button styles */
    .button {
      background-color: var(--primary-color);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(108, 92, 231, 0.2);
    }

    .button:hover {
      background-color: var(--accent-color);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(108, 92, 231, 0.3);
    }

    .button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(108, 92, 231, 0.2);
    }

    .button-outline {
      background-color: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
    }

    .button-outline:hover {
      background-color: var(--primary-color);
      color: white;
    }

    /* Special styling for important buttons */
    .image-upload-button {
      background: linear-gradient(135deg, var(--primary-color), var(--light-accent));
      color: white;
      font-weight: 600;
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.2);
    }

    .image-upload-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);
      background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
    }

    #sendForReview {
      background: linear-gradient(135deg, var(--primary-color), var(--light-accent));
      color: white;
      font-weight: 600;
      padding: 14px 32px;
      border: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.2);
      margin-top: 20px;
    }

    #sendForReview:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);
      background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
    }

    /* Header styles */
    .header {
      background: linear-gradient(135deg, #6c5ce7, #63b3f0);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-lg);
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 25px;
      flex-wrap: wrap;
      text-align: center;
    }

    .header span {
      margin: 0 5px;
    }

    .header .newedu {
      color: #55efa7; /* Light green */
      font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      font-weight: bold;
    }

    .header .bluebook {
      color: #00bbff; /* Light blue */
    }

    @media (max-width: 768px) {
      .header {
        font-size: 20px;
        padding: var(--spacing-sm);
      }

      .header span {
        margin: 0 3px;
      }
    }

    @media (max-width: 480px) {
      .header {
        font-size: 16px;
        padding: var(--spacing-sm);
      }

      .header span {
        margin: 0 2px;
      }
    }

    /* Simple Image Upload */
    .image-section {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px;
      border-radius: var(--border-radius);
      background-color: var(--secondary-color);
      max-width: 100%;
    }

    .image-section .button {
      white-space: nowrap;
      min-width: 120px;
      flex-shrink: 0;
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0; /* Required for text-overflow to work */
      max-width: calc(100% - 130px); /* Account for button width + gap */
      overflow: hidden;
    }

    #imageFileName {
      color: #666;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: calc(100% - 30px); /* Account for remove button */
      display: inline-block;
    }
    
    #removeImageBtn {
      color: #ff4444;
      border: none;
      background: none;
      cursor: pointer;
      padding: 0 8px;
      font-size: 30px;
      flex-shrink: 0;
      width: 24px;
    }
    
    #removeImageBtn:hover {
      color: #ff6a00;
    }

    @media (max-width: 768px) {
      .image-section {
        flex-direction: column;
        align-items: stretch;
      }

      .image-section .button {
        width: 100%;
      }

      .file-info {
        width: 100%;
        max-width: 100%;
      }

      #imageFileName {
        max-width: calc(100% - 30px);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <span class="newedu">NewEdu</span>
      <span>&gt;</span>
      <span class="bluebook">Bluebook.uz</span>
      <span>&gt;</span>
      <span>Question creator</span>
      <span>&gt;</span>
      <span>Math</span>
    </div>
    <!-- Top Grid: Desmos and Question Input -->
    <div class="grid grid-cols-2 gap-6">
      <!-- Left Column: Desmos Calculator -->
      <div class="card">
        <p style="font-size: 14px; color: #666; margin-bottom: 16px;">
          You can copy the expression to the question input*
        </p>
        <div id="calculator" style="width: 100%; height: 470px;"></div>
      </div>
      <!-- Right Column: Question Input and Image Upload -->
      <div class="card">
        <label for="question" class="label">Question input:</label>
        <textarea id="question" class="textarea" placeholder="Enter your question here" style="height: 375px; margin-bottom: 16px; margin-top: 10px;"></textarea>
        
        <!-- Simple Image Upload -->
        <div class="image-section" style="margin-bottom: 16px;">
          <input type="file" id="imageInput" accept="image/*" style="display: none;">
          <button class="button button-outline" onclick="document.getElementById('imageInput').click()">Upload Image</button>
          <div class="file-info">
            <span id="imageFileName"></span>
            <button id="removeImageBtn" style="display: none;">Ã—</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation Checkbox -->
    <div class="confirmation" style="margin-top: 24px;">
      <input type="checkbox" id="confirmSource">
      <label for="confirmSource">
        Confirm that your question is not from College Board's Question Bank
      </label>
    </div>

    <!-- Second Grid: Answer Section (Toggle between Open Answer and Multiple Choice) -->
    <div class="grid grid-cols-2 gap-6" style="margin-top: 24px;">
      <!-- Left Card: Answer Section -->
      <div class="card">
        <div class="question-type-toggle">
          <label for="openQuestionSwitch">Is this an open question?</label>
          <input type="checkbox" id="openQuestionSwitch">
        </div>

        <!-- Multiple Choice Section -->
        <div id="multipleChoiceSection">
          <div>
            <label class="label">Answer options:</label>
            <div class="answer-options" style="display: flex; flex-direction: column; gap: 10px;">
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctA" value="A">
                <label for="correctA" style="margin-right: 8px;">A.</label>
                <input type="text" class="input" placeholder="Enter option A" style="width: 90%;">
              </div>
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctB" value="B">
                <label for="correctB" style="margin-right: 8px;">B.</label>
                <input type="text" class="input" placeholder="Enter option B" style="width: 90%;">
              </div>
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctC" value="C">
                <label for="correctC" style="margin-right: 8px;">C.</label>
                <input type="text" class="input" placeholder="Enter option C" style="width: 90%;">
              </div>
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctD" value="D">
                <label for="correctD" style="margin-right: 8px;">D.</label>
                <input type="text" class="input" placeholder="Enter option D" style="width: 90%;">
              </div>
            </div>
          </div>
        </div>

        <!-- Open Answer Section -->
        <div id="openAnswerSection" style="display: none;">
          <div class="open-answer">
            <label>Main Answer</label>
            <textarea placeholder="Enter the main answer"></textarea>
          </div>
          <div class="open-answer">
            <label>Alternative Answers (Optional)</label>
            <textarea placeholder="Enter alternative answers"></textarea>
          </div>
        </div>
      </div>
      <!-- Right Card: Detailed Explanation -->
      <div class="card" style="height: 466px;">
        <label for="explanation" class="label">A detailed explanation:</label>
        <textarea id="explanation" class="textarea" placeholder="Enter your explanation here" style="height: 395px;"></textarea>
      </div>
    </div>

    <!-- Bottom Section: Rating, Open Question Switch, Unique ID and Review Button -->
    <div class="bottom-section" style="display: flex; justify-content: space-between; align-items: center;">
      <div class="rating-container">
        <label class="label">Please rate how well your question is thought out:</label>
        <div class="stars">
          <button type="button" class="star">â˜…</button>
          <button type="button" class="star">â˜…</button>
          <button type="button" class="star">â˜…</button>
          <button type="button" class="star">â˜…</button>
          <button type="button" class="star">â˜…</button>
        </div>
      </div>
      <div class="review-section" style="display: flex; align-items: center;">
        <button type="button" class="button button-secondary" id="sendForReview">
          Send for review
        </button>
      </div>
    </div>
  </div>

  <script>
    // Global function for removing image
    function removeImage() {
      const input = document.getElementById('imageInput');
      const fileNameSpan = document.getElementById('imageFileName');
      const removeBtn = document.getElementById('removeImageBtn');
      
      input.value = '';
      fileNameSpan.textContent = '';
      removeBtn.style.display = 'none';
    }

    // Wait for the DOM to load
    document.addEventListener("DOMContentLoaded", function () {
      /* --- Desmos Calculator Initialization --- */
      var calculatorContainer = document.getElementById("calculator");
      var calculator;
      // Dynamically load the Desmos API script
      var desmosScript = document.createElement("script");
      desmosScript.src = "https://www.desmos.com/api/v1.7/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6";
      desmosScript.async = true;
      desmosScript.onload = function () {
        calculator = Desmos.GraphingCalculator(calculatorContainer, {
          expressions: true,
          settingsMenu: true,
          zoomButtons: true,
          lockViewport: false,
          expressionsTopbar: true,
          keypad: true,
          graphpaper: true,
          administerSecretFolders: true,
          folders: true,
          notes: true,
          pasteGraphLink: true,
          pointsOfInterest: true,
          trace: true,
          borders: true,
          labels: true,
          tips: true,
          qwertyKeyboard: true,
          restrictedFunctions: false,
          restrictGrids: false,
          authorFeatures: true,
        });
        // Observe changes in the calculator state
        calculator.observeEvent("change", function () {
          var state = calculator.getState();
          console.log("Calculator state updated:", state);
        });
      };
      document.body.appendChild(desmosScript);

      /* --- Image Upload Logic --- */
      document.getElementById('imageInput').addEventListener('change', function(e) {
        const fileNameSpan = document.getElementById('imageFileName');
        const removeBtn = document.getElementById('removeImageBtn');
        
        if (this.files && this.files[0]) {
          const fileName = this.files[0].name;
          fileNameSpan.textContent = fileName;
          removeBtn.style.display = 'inline';
        }
      });

      document.getElementById('removeImageBtn').addEventListener('click', removeImage);

      /* --- Rating Stars Logic --- */
      var stars = document.querySelectorAll(".star");
      var ratingValue = 0;
      var hoverRating = 0;

      stars.forEach(function (star, index) {
        star.addEventListener("mouseenter", function () {
          hoverRating = index + 1;
          updateStars();
        });
        star.addEventListener("mouseleave", function () {
          hoverRating = ratingValue;
          updateStars();
        });
        star.addEventListener("click", function () {
          ratingValue = index + 1;
          hoverRating = ratingValue;
          updateStars();
          console.log("Rating selected:", ratingValue);
        });
      });

      function updateStars() {
        stars.forEach(function (star, index) {
          if (index < hoverRating) {
            star.classList.add("rated");
          } else {
            star.classList.remove("rated");
          }
        });
      }

      /* --- Open Question Switch --- */
      var openQuestionSwitch = document.getElementById("openQuestionSwitch");
      var openAnswerSection = document.getElementById("openAnswerSection");
      var multipleChoiceSection = document.getElementById("multipleChoiceSection");

      // Set initial state
      if (openQuestionSwitch.checked) {
        openAnswerSection.style.display = "block";
        multipleChoiceSection.style.display = "none";
      } else {
        openAnswerSection.style.display = "none";
        multipleChoiceSection.style.display = "block";
      }

      openQuestionSwitch.addEventListener("change", function () {
        if (this.checked) {
          openAnswerSection.style.display = "block";
          multipleChoiceSection.style.display = "none";
        } else {
          openAnswerSection.style.display = "none";
          multipleChoiceSection.style.display = "block";
        }
      });

      /* --- Send for Review Button --- */
      const TELEGRAM_BOT_TOKEN = "7937788978:AAEq3rNdQpA0YLF4Vlqn0tnosRGTWLu3qQ0";
      const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}`;
      const CHAT_ID = "-1002253341086"; // Group chat ID without topic

      // Function to generate a random ID
      function generateRandomId(length = 8) {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
          result += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return result;
      }

      // Function to create structured text message
      function createStructuredMessage(data) {
        const stars = "â­".repeat(data.rating);
        const questionType = data.answers.type === "open" ? "ðŸ“ Open Question" : "ðŸ“‹ Multiple Choice";
        
        let answersText = "";
        if (data.answers.type === "open") {
          answersText = `ðŸ’¡ *Main Answer:*\n${data.answers.mainAnswer}\n`;
          if (data.answers.alternativeAnswers) {
            answersText += `\nðŸ”„ *Alternative Answers:*\n${data.answers.alternativeAnswers}`;
          }
        } else {
          answersText = Object.entries(data.answers.options)
            .map(([letter, text]) => {
              const isCorrect = letter === data.answers.correctAnswer;
              return `${isCorrect ? 'âœ…' : 'â­•'} ${letter}. ${text}`;
            })
            .join("\n");
        }

        return `ðŸŽ¯ *New Question (#${data.uniqueId})*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ“Œ *Question:*
${data.question}

${questionType}
${stars} Rating
ðŸ–¼ï¸ Image: ${data.requiresImage ? "Required" : "Optional"}

ðŸ“ *Answers:*
${answersText}

ðŸ“‹ *Explanation:*
${data.explanation}

â° *Submitted:* ${new Date().toLocaleString()}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
      }

      document.getElementById("sendForReview").addEventListener("click", async function() {
        // Validate required fields
        const question = document.getElementById("question").value;

        if (!question) {
          alert("Please enter a question");
          return;
        }

        const hasImage = document.getElementById("imageInput").files && document.getElementById("imageInput").files[0];
        if (!hasImage) {
          alert("This question requires an image. Please upload one.");
          return;
        }

        // Get answers based on question type
        const isOpenQuestion = document.getElementById("openQuestionSwitch").checked;
        if (!isOpenQuestion) {
          const selectedAnswer = document.querySelector('input[name="correctAnswer"]:checked');
          if (!selectedAnswer) {
            alert("Please select the correct answer for the multiple choice question");
            return;
          }
        }

        // Collect the data
        const formData = {
          question: question,
          requiresImage: true,
          answers: {},
          rating: 0,
          uniqueId: generateRandomId(),
          explanation: document.getElementById("explanation").value,
          timestamp: new Date().toISOString()
        };

        // Get rating value
        const stars = document.querySelectorAll(".star");
        stars.forEach((star, index) => {
          if (star.classList.contains("rated")) {
            formData.rating = index + 1;
          }
        });

        // Get answers based on question type
        if (isOpenQuestion) {
          const mainAnswerTextarea = document.querySelector("#openAnswerSection .open-answer:first-child textarea");
          const alternativeAnswersTextarea = document.querySelector("#openAnswerSection .open-answer:last-child textarea");
          
          formData.answers = {
            type: "open",
            mainAnswer: mainAnswerTextarea ? mainAnswerTextarea.value : "",
            alternativeAnswers: alternativeAnswersTextarea ? alternativeAnswersTextarea.value : ""
          };
        } else {
          const options = document.querySelectorAll(".answer-option input[type='text']");
          const correctAnswer = document.querySelector('input[name="correctAnswer"]:checked').value;
          formData.answers = {
            type: "multiple_choice",
            options: {
              A: options[0].value,
              B: options[1].value,
              C: options[2].value,
              D: options[3].value
            },
            correctAnswer: correctAnswer
          };
        }

        // Add image at the end if it exists
        if (hasImage) {
          formData.image = document.getElementById("imageInput").files[0];
        }

        // Create and download JSON file locally
        const jsonBlob = new Blob([JSON.stringify(formData, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(jsonBlob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `question_${formData.uniqueId}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // Send to Telegram
        const sent = await sendToTelegram(formData);
        if (sent) {
          alert("Question has been sent for review successfully!");
        } else {
          alert("Failed to send question for review. Please try again.");
        }
      });

      async function sendToTelegram(data) {
        try {
          // First send the structured text message
          const structuredMessage = createStructuredMessage(data);
          const messageData = {
            chat_id: CHAT_ID,
            text: structuredMessage,
            parse_mode: "Markdown"
          };

          const textResponse = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(messageData)
          });

          if (!textResponse.ok) {
            throw new Error("Failed to send text message to Telegram");
          }

          // If there's an image file, send it
          if (data.image) {
            const imageFormData = new FormData();
            imageFormData.append("photo", data.image);
            imageFormData.append("chat_id", CHAT_ID);
            imageFormData.append("caption", `ðŸ“¸ Image for Question #${data.uniqueId}`);

            const imageResponse = await fetch(`${TELEGRAM_API_URL}/sendPhoto`, {
              method: "POST",
              body: imageFormData
            });

            if (!imageResponse.ok) {
              throw new Error("Failed to send image to Telegram");
            }
          }

          // Send the JSON file
          const jsonBlob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
          const formData = new FormData();
          formData.append("document", jsonBlob, `question_${data.uniqueId}.json`);
          formData.append("chat_id", CHAT_ID);
          formData.append("caption", `ðŸ“„ JSON Data for Question #${data.uniqueId}`);
          
          const response = await fetch(`${TELEGRAM_API_URL}/sendDocument`, {
            method: "POST",
            body: formData
          });

          if (!response.ok) {
            throw new Error("Failed to send JSON to Telegram");
          }

          return true;
        } catch (error) {
          console.error("Error sending to Telegram:", error);
          alert(`Error: ${error.message}`);
          return false;
        }
      }
    });
  </script>
</body>
</html>