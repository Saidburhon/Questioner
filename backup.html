<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Converted Component</title>
  <style>
    /* Base styles */
    :root {
      --primary-color: #6c5ce7;  /* Light purple */
      --secondary-color: #e8f1ff; /* Light blue */
      --accent-color: #4834d4;   /* Darker purple for hover states */
      --light-accent: #a29bfe;   /* Lighter purple */
      --text-color: #2d3436;
      --border-radius: 8px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      padding: var(--spacing-md);
      background-color: var(--secondary-color);
      color: var(--text-color);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: var(--spacing-md);
    }

    /* Grid system */
    .grid {
      display: grid;
      gap: var(--spacing-md);
    }

    .grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    /* Card styles */
    .card {
      background-color: #ffffff;
      border: 1px solid rgba(108, 92, 231, 0.1);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.1);
      height: fit-content;
      min-height: 200px;
      overflow: hidden;
      width: 100%;
    }

    /* Calculator container */
    #calculator {
      width: 100%;
      height: 400px;
      border: none;
    }

    /* Form elements */
    .input, .textarea {
      width: 100%;
      padding: var(--spacing-sm);
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-md);
      font-size: 14px;
    }

    .textarea {
      background-color: white;
      padding: 12px;
      transition: border-color 0.3s ease;
      resize: vertical; /* Allow only vertical resizing */
      min-height: 150px; /* Set a minimum height */
    }

    .textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      outline: none;
    }

    .textarea, #question, #explanation {
      font-size: 16px;
    }

    #question {
      height: 200px;
    }

    #explanation {
      height: 150px;
    }

    /* Answer options */
    .answer-options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }

    .answer-option {
      background-color: var(--secondary-color);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      transition: all 0.2s ease;
    }

    .answer-option:hover {
      background-color: #eef2f7;
    }

    .answer-option label {
      font-weight: 500;
      color: #333;
      cursor: pointer;
      user-select: none;
    }

    .answer-option input[type="text"] {
      flex: 1;
      margin: 0;
      height: 40px;
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      padding: var(--spacing-sm);
      transition: all 0.2s ease;
    }

    .answer-option input[type="text"]:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      outline: none;
    }

    .answer-option input[type="radio"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--primary-color);
      border-radius: 50%;
      outline: none;
      margin-right: var(--spacing-sm);
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .answer-option input[type="radio"]:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .answer-option input[type="radio"]:checked::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: white;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .answer-option input[type="radio"]:hover {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
    }

    @media (hover: hover) {
      .answer-option:hover {
        transform: translateX(4px);
      }
    }

    @media (max-width: 768px) {
      .answer-option input[type="radio"] {
        width: 24px;
        height: 24px;
      }

      .answer-option input[type="radio"]:checked::after {
        width: 10px;
        height: 10px;
      }
    }

    /* Image preview */
    .image-preview-container {
      position: relative;
      margin-top: var(--spacing-md);
      display: none;
    }

    .image-preview-container.visible {
      display: block;
    }

    .image-preview-container img {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius);
    }

    /* Image remove button styling */
    .remove-image-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background-color: rgba(255, 68, 68, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .remove-image-btn:hover {
      background-color: rgb(255, 68, 68);
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .remove-image-btn:active {
      transform: scale(0.95);
    }

    .remove-image-btn i {
      font-size: 18px;
      line-height: 1;
    }

    /* Rating stars */
    .stars {
      display: flex;
      gap: var(--spacing-sm);
      margin: var(--spacing-md) 0;
    }

    .star {
      background: none;
      border: none;
      font-size: 24px;
      color: #ddd;
      cursor: pointer;
    }

    .star.rated {
      color: #ffd700;
    }

    /* Bottom section */
    .bottom-section {
      margin-top: var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--spacing-md);
    }

    .rating-container, .review-section {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: 1fr;
      }

      .bottom-section {
        flex-direction: column;
        align-items: stretch;
      }

      .rating-container, .review-section {
        flex-direction: column;
        align-items: stretch;
      }

      .card {
        padding: var(--spacing-md);
      }

      .answer-option {
        flex-wrap: wrap;
      }

      .answer-option input[type="text"] {
        width: 100%;
        margin-top: var(--spacing-sm);
      }

      .stars {
        justify-content: center;
      }

      .button {
        width: 100%;
        margin-top: var(--spacing-sm);
      }

      #question {
        height: 250px;
      }

      #explanation {
        height: 200px;
      }

      #calculator {
        height: 350px;
      }

      .answer-option input[type="text"] {
        height: 44px;
        font-size: 16px;
      }

      #openAnswerSection .open-answer textarea {
        height: 120px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: var(--spacing-sm);
      }

      .container {
        padding: var(--spacing-sm);
      }

      .card {
        padding: var(--spacing-sm);
      }

      .stars {
        flex-wrap: wrap;
      }

      .input, .textarea {
        font-size: 16px; /* Prevents zoom on mobile */
      }
    }

    /* Switch styles */
    .switch-container {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin: var(--spacing-md) 0;
    }

    input[type="checkbox"] {
      margin-right: var(--spacing-sm);
    }

    /* Confirmation section */
    .confirmation {
      margin: var(--spacing-lg) 0;
    }

    .warning {
      color: #ff4444;
      font-size: 14px;
      margin: var(--spacing-sm) 0;
    }

    /* Open answer styling */
    .open-answer {
      background-color: var(--secondary-color);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-md);
      transition: all 0.2s ease;
    }

    .open-answer:hover {
      background-color: #eef2f7;
    }

    .open-answer textarea {
      width: 100%;
      height: 100px;
      padding: var(--spacing-sm);
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      background-color: white;
      resize: none;
      transition: all 0.2s ease;
    }

    .open-answer textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
      outline: none;
    }

    .open-answer label {
      display: block;
      font-weight: 500;
      color: #333;
      margin-bottom: var(--spacing-sm);
    }

    /* Question type toggle styling */
    .question-type-toggle {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      padding: var(--spacing-md);
      background-color: var(--secondary-color);
      border-radius: var(--border-radius);
    }

    .question-type-toggle label {
      font-weight: 500;
      color: #333;
      cursor: pointer;
      user-select: none;
    }

    .question-type-toggle input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: var(--spacing-sm);
    }

    /* Image upload section styling */
    .image-upload-container {
      height: 0;
      overflow: hidden;
      opacity: 0;
      transition: height 0.3s ease-out, opacity 0.3s ease-out;
    }

    .image-upload-container.expanded {
      height: auto;
      opacity: 1;
    }

    .image-preview-container {
      position: relative;
      margin-top: var(--spacing-md);
    }

    #imagePreview {
      max-width: 100%;
      height: auto;
      border-radius: var(--border-radius);
      display: none;
    }

    #imagePreview.visible {
      display: block;
    }

    #imagePreview img {
      max-width: 100%;
      height: auto;
      max-height: none;
      border-radius: var(--border-radius);
    }

    .image-upload-button {
      display: none;
    }

    .image-upload-button.visible {
      display: inline-block;
    }

    /* Enhanced button styles */
    .button {
      background-color: var(--primary-color);
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(108, 92, 231, 0.2);
    }

    .button:hover {
      background-color: var(--accent-color);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(108, 92, 231, 0.3);
    }

    .button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(108, 92, 231, 0.2);
    }

    .button-outline {
      background-color: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
    }

    .button-outline:hover {
      background-color: var(--primary-color);
      color: white;
    }

    /* Special styling for important buttons */
    .image-upload-button {
      background: linear-gradient(135deg, var(--primary-color), var(--light-accent));
      color: white;
      font-weight: 600;
      padding: 12px 28px;
      border: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.2);
    }

    .image-upload-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);
      background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
    }

    #sendForReview {
      background: linear-gradient(135deg, var(--primary-color), var(--light-accent));
      color: white;
      font-weight: 600;
      padding: 14px 32px;
      border: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.2);
      margin-top: 20px;
    }

    #sendForReview:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);
      background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
    }

    /* Header styles */
    .header {
      background: linear-gradient(135deg, #6c5ce7, #63b3f0);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-lg);
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 25px;
      flex-wrap: wrap;
      text-align: center;
    }

    .header span {
      margin: 0 5px;
    }

    .header .newedu {
      color: #55efa7; /* Light green */
      font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      font-weight: bold;
    }

    .header .bluebook {
      color: #00bbff; /* Light blue */
    }

    @media (max-width: 768px) {
      .header {
        font-size: 20px;
        padding: var(--spacing-sm);
      }

      .header span {
        margin: 0 3px;
      }
    }

    @media (max-width: 480px) {
      .header {
        font-size: 16px;
        padding: var(--spacing-sm);
      }

      .header span {
        margin: 0 2px;
      }
    }

    /* Simple Image Upload */
    .image-section {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px;
      border-radius: var(--border-radius);
      background-color: var(--secondary-color);
      max-width: 100%;
    }

    .image-section .button {
      white-space: nowrap;
      min-width: 120px;
      flex-shrink: 0;
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0; /* Required for text-overflow to work */
      max-width: calc(100% - 130px); /* Account for button width + gap */
      overflow: hidden;
    }

    #imageFileName {
      color: #666;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: calc(100% - 30px); /* Account for remove button */
      display: inline-block;
    }
    
    #removeImageBtn {
      color: #ff4444;
      border: none;
      background: none;
      cursor: pointer;
      padding: 0 8px;
      font-size: 30px;
      flex-shrink: 0;
      width: 24px;
    }
    
    #removeImageBtn:hover {
      color: #ff6a00;
    }

    @media (max-width: 768px) {
      .image-section {
        flex-direction: column;
        align-items: stretch;
      }

      .image-section .button {
        width: 100%;
      }

      .file-info {
        width: 100%;
        max-width: 100%;
      }

      #imageFileName {
        max-width: calc(100% - 30px);
      }
    }

    /* Preview section styles */
    .preview-section {
      background-color: var(--secondary-color);
      border-radius: var(--border-radius);
      padding: 16px;
      margin-top: 8px;
      margin-bottom: 16px;
    }

    .preview-section .preview-header {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-section .preview-content {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 16px;
      min-height: 50px;
      overflow-x: auto;
    }

    .preview-section .toggle-source {
      font-size: 12px;
      color: var(--primary-color);
      cursor: pointer;
      border: none;
      background: none;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .preview-section .toggle-source:hover {
      background-color: rgba(108, 92, 231, 0.1);
    }

    .source-visible .preview-content {
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .preview-section .math-help {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
      padding: 12px;
      background-color: #fff;
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
    }

    .preview-section .math-help .syntax-guide {
      flex: 1;
    }

    .preview-section .math-help .example-button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 13px;
      white-space: nowrap;
      transition: background-color 0.2s;
      width: 100%; /* Make button full width */
    }

    .preview-section .math-help .example-button:hover {
      background-color: var(--accent-color);
    }

    .preview-section .math-help .example {
      margin-top: 12px;
      padding: 12px;
      background-color: var(--secondary-color);
      border-radius: var(--border-radius);
      font-size: 14px;
      color: var(--text-color);
    }

    .preview-section .math-help .example-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--primary-color);
    }

    .preview-section .math-help .syntax-guide {
      margin-bottom: 12px;
    }

    /* Difficulty selector styles */
    .difficulty-selector {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .difficulty-btn {
      flex: 1;
      padding: 10px 16px;
      border: 2px solid transparent;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .difficulty-btn.easy {
      background-color: #a8e6cf;
      color: #1a5d1a;
      box-shadow: 0 2px 4px rgba(168, 230, 207, 0.3);
    }

    .difficulty-btn.medium {
      background-color: #ffd3b6;
      color: #964e00;
      box-shadow: 0 2px 4px rgba(255, 211, 182, 0.3);
    }

    .difficulty-btn.hard {
      background-color: #ffaaa5;
      color: #9b2226;
      box-shadow: 0 2px 4px rgba(255, 170, 165, 0.3);
    }

    .difficulty-btn.selected {
      border-color: var(--primary-color);
      transform: scale(0.98);
      box-shadow: none;
    }

    .difficulty-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .difficulty-btn.selected:hover {
      transform: scale(0.98);
      box-shadow: none;
    }

    /* Image upload button styles */
    .explanation-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 12px;
    }

    .explanation-image-upload {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .explanation-image-upload .button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .explanation-image-upload .button:hover {
      background-color: var(--accent-color);
      transform: translateY(-1px);
    }

    .explanation-image-upload .button svg {
      width: 20px;
      height: 20px;
    }

    .image-upload-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background-color: var(--secondary-color);
      border-radius: var(--border-radius);
      margin-top: 4px;
    }

    /* Topic selector styles */
    .topic-selector {
      position: relative;
      margin-bottom: 16px;
    }

    .topic-select {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(108, 92, 231, 0.2);
      border-radius: var(--border-radius);
      font-size: 14px;
      color: var(--text-color);
      background-color: white;
      cursor: pointer;
      appearance: none;
    }

    .topic-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.1);
    }

    .topic-group {
      font-weight: bold;
      color: var(--primary-color);
    }

    .topic-option {
      padding-left: 20px;
      color: var(--text-color);
    }

    .topic-count {
      color: #666;
      font-size: 12px;
      margin-left: 8px;
    }

    /* Custom dropdown arrow */
    .topic-selector::after {
      content: '';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid var(--primary-color);
      pointer-events: none;
    }

    .explanation-textarea {
      resize: vertical;
      min-height: 150px;
      max-height: 500px;
    }
  </style>
  <!-- Add KaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <span class="newedu">NewEdu</span>
      <span>&gt;</span>
      <span class="bluebook">Bluebook.uz</span>
      <span>&gt;</span>
      <span>Question creator</span>
      <span>&gt;</span>
      <span>Math</span>
    </div>
    <!-- Top Grid: Desmos and Question Input -->
    <div class="grid grid-cols-2 gap-6">
      <!-- Left Column: Desmos Calculator -->
      <div class="card">
        <div id="calculator" style="width: 100%; height: 612px;"></div>
      </div>
      <!-- Right Column: Question Input and Image Upload -->
      <div class="card">
        <label for="question" class="label">Question input:</label>
        <textarea id="question" class="textarea" placeholder="Enter your question here.

Use $ for inline math (e.g., $\frac{1}{2}$) and 

$$ for display math (e.g., $$\sqrt{x^2 + y^2}$$)" style="height: 190px; margin-bottom: 16px; margin-top: 10px;"></textarea>
        
        <!-- Preview Section -->
        <div class="preview-section">
          <div class="preview-header">
            <span>Preview:</span>
            <button class="toggle-source" onclick="toggleSource()">Show Source</button>
          </div>
          <div class="preview-content"></div>
          <div class="math-help">
            <div class="syntax-guide">
              <strong>Math Syntax Guide:</strong><br>
              • Inline math: Use $...$ for math within text<br>
              • Display math: Use $$...$$ for standalone equations<br>
              • You can copy expressions from Desmos and paste them here!
            </div>
            <button class="example-button" onclick="insertExample()">
              Insert Example
            </button>
          </div>
        </div>
        
        <!-- Simple Image Upload -->
        <div class="image-section" style="margin-bottom: 16px;">
          <input type="file" id="imageInput" accept="image/*" style="display: none;">
          <button class="button button-outline" onclick="document.getElementById('imageInput').click()">Upload Image</button>
          <div class="file-info">
            <span id="imageFileName"></span>
            <button id="removeImageBtn" style="display: none;">×</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation Checkbox -->
    <div class="confirmation" style="margin-top: 24px;">
      <input type="checkbox" id="confirmSource">
      <label for="confirmSource">
        Confirm that your question is not from College Board's Question Bank
      </label>
    </div>

    <!-- Second Grid: Answer Section (Toggle between Open Answer and Multiple Choice) -->
    <div class="grid grid-cols-2 gap-6" style="margin-top: 24px;">
      <!-- Left Card: Answer Section -->
      <div class="card">
        <div class="question-type-toggle">
          <label for="openQuestionSwitch">Is this an open question?</label>
          <input type="checkbox" id="openQuestionSwitch">
        </div>

        <!-- Multiple Choice Section -->
        <div id="multipleChoiceSection">
          <div>
            <label class="label">Answer options:</label>
            <div class="answer-options" style="display: flex; flex-direction: column; gap: 10px;">
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctA" value="A">
                <label for="correctA" style="margin-right: 8px;">A.</label>
                <input type="text" class="input" placeholder="Enter option A" style="width: 90%;">
              </div>
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctB" value="B">
                <label for="correctB" style="margin-right: 8px;">B.</label>
                <input type="text" class="input" placeholder="Enter option B" style="width: 90%;">
              </div>
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctC" value="C">
                <label for="correctC" style="margin-right: 8px;">C.</label>
                <input type="text" class="input" placeholder="Enter option C" style="width: 90%;">
              </div>
              <div class="answer-option">
                <input type="radio" name="correctAnswer" id="correctD" value="D">
                <label for="correctD" style="margin-right: 8px;">D.</label>
                <input type="text" class="input" placeholder="Enter option D" style="width: 90%;">
              </div>
            </div>
          </div>
        </div>

        <!-- Open Answer Section -->
        <div id="openAnswerSection" style="display: none;">
          <div class="open-answer">
            <label>Main Answer</label>
            <textarea placeholder="Enter the main answer"></textarea>
          </div>
          <div class="open-answer">
            <label>Alternative Answers (Optional)</label>
            <textarea placeholder="Enter alternative answers"></textarea>
          </div>
        </div>
      </div>
      <!-- Right Card: Detailed Explanation -->
      <div class="card" style="height: auto; min-height: 466px;">
        <!-- Topic Selector -->
        <div class="topic-selector">
          <select class="topic-select" id="topicSelect">
            <option value="">Select a topic of the question...</option>
            <optgroup label="Algebra" class="topic-group">
              <option value="linear_equations_one" class="topic-option">Linear equations in one variable</option>
              <option value="linear_functions" class="topic-option">Linear functions</option>
              <option value="linear_equations_two" class="topic-option">Linear equations in two variables</option>
              <option value="systems_linear_equations" class="topic-option">Systems of two linear equations in two variables</option>
              <option value="linear_inequalities" class="topic-option">Linear inequalities in one or two variables</option>
            </optgroup>
            <optgroup label="Advanced Math" class="topic-group">
              <option value="equivalent_expressions" class="topic-option">Equivalent expressions</option>
              <option value="nonlinear_equations" class="topic-option">Nonlinear equations in one variable and systems</option>
              <option value="nonlinear_functions" class="topic-option">Nonlinear functions</option>
            </optgroup>
            <optgroup label="Problem-Solving and Data Analysis" class="topic-group">
              <option value="ratios_rates" class="topic-option">Ratios, rates, proportional relationships, and units</option>
              <option value="percentages" class="topic-option">Percentages</option>
              <option value="one_variable_data" class="topic-option">One-variable data: Distributions and measures</option>
              <option value="two_variable_data" class="topic-option">Two-variable data: Models and scatterplots</option>
              <option value="probability" class="topic-option">Probability and conditional probability</option>
              <option value="inference" class="topic-option">Inference from sample statistics</option>
              <option value="statistical_claims" class="topic-option">Evaluating statistical claims</option>
            </optgroup>
            <optgroup label="Geometry and Trigonometry" class="topic-group">
              <option value="area_volume" class="topic-option">Area and volume</option>
              <option value="lines_angles" class="topic-option">Lines, angles, and triangles</option>
              <option value="right_triangles" class="topic-option">Right triangles and trigonometry</option>
              <option value="circles" class="topic-option">Circles</option>
            </optgroup>
          </select>
        </div>

        <label for="explanation" class="label">A detailed explanation:</label>
        <textarea id="explanation" class="textarea explanation-textarea" placeholder="Enter your explanation here"></textarea>
        
        <div class="explanation-actions">
          <!-- Image Upload for Explanation -->
          <div class="explanation-image-upload">
            <input type="file" id="explanationImageInput" accept="image/*" style="display: none;">
            <button class="button" onclick="document.getElementById('explanationImageInput').click()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
              Add Photo Explanation
            </button>
            <div id="explanationImageInfo" class="image-upload-info" style="display: none;">
              <span id="explanationFileName"></span>
              <button class="remove-explanation-image" onclick="removeExplanationImage()">×</button>
            </div>
          </div>

          <!-- Difficulty Selector -->
          <div>
            <label class="label">Choose your question's Difficulty Level:</label>
            <div class="difficulty-selector">
              <button class="difficulty-btn easy" onclick="selectDifficulty('easy')">Easy</button>
              <button class="difficulty-btn medium" onclick="selectDifficulty('medium')">Medium</button>
              <button class="difficulty-btn hard" onclick="selectDifficulty('hard')">Hard</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Section: Rating, Open Question Switch, Unique ID and Review Button -->
    <div class="bottom-section" style="display: flex; justify-content: space-between; align-items: center;">
      <div class="rating-container">
        <label class="label">Please rate how well your question is thought out:</label>
        <div class="stars">
          <button type="button" class="star">★</button>
          <button type="button" class="star">★</button>
          <button type="button" class="star">★</button>
          <button type="button" class="star">★</button>
          <button type="button" class="star">★</button>
        </div>
      </div>
      <div class="review-section" style="display: flex; align-items: center;">
        <button type="button" class="button button-secondary" id="sendForReview">
          Send for review
        </button>
      </div>
    </div>
  </div>

  <script>
    let showingSource = false;
    let selectedDifficulty = null;

    function insertExample() {
      const exampleText = `If the expression $\\frac{\\sqrt{16}}{x^{2}}$ is equal to 1, solve the below:

$$\\sqrt{\\frac{123^{\\frac{\\pi}{\\log\\left(234^{\\frac{2}{3}}\\right)}}}{\\sin15+\\frac{\\pi}{x}}}$$

And multiply the result by $\\pi$`;

      const questionInput = document.getElementById('question');
      questionInput.value = exampleText;
      questionInput.focus();
      updatePreview();
    }

    function selectDifficulty(level) {
      const buttons = document.querySelectorAll('.difficulty-btn');
      buttons.forEach(btn => btn.classList.remove('selected'));
      
      if (selectedDifficulty === level) {
        selectedDifficulty = null;
      } else {
        selectedDifficulty = level;
        document.querySelector(`.difficulty-btn.${level}`).classList.add('selected');
      }
    }

    function removeExplanationImage() {
      const input = document.getElementById('explanationImageInput');
      const info = document.getElementById('explanationImageInfo');
      const fileName = document.getElementById('explanationFileName');
      
      input.value = '';
      fileName.textContent = '';
      info.style.display = 'none';
    }

    function toggleSource() {
      const previewSection = document.querySelector('.preview-section');
      const toggleButton = document.querySelector('.toggle-source');
      const previewContent = document.querySelector('.preview-content');
      
      showingSource = !showingSource;
      
      if (showingSource) {
        previewSection.classList.add('source-visible');
        toggleButton.textContent = 'Show Preview';
        previewContent.textContent = document.getElementById('question').value;
      } else {
        previewSection.classList.remove('source-visible');
        toggleButton.textContent = 'Show Source';
        updatePreview();
      }
    }

    function updatePreview() {
      if (showingSource) return;
      
      const input = document.getElementById('question').value;
      const previewContent = document.querySelector('.preview-content');
      
      // Clear the preview content
      previewContent.innerHTML = input;
      
      // Render all math in the preview
      renderMathInElement(previewContent, {
        delimiters: [
          {left: "$$", right: "$$", display: true},
          {left: "$", right: "$", display: false}
        ],
        throwOnError: false,
        output: 'html'
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Preview update listener
      document.getElementById('question').addEventListener('input', updatePreview);
      
      // Explanation image upload listener
      document.getElementById('explanationImageInput').addEventListener('change', function(e) {
        const info = document.getElementById('explanationImageInfo');
        const fileName = document.getElementById('explanationFileName');
        
        if (this.files && this.files[0]) {
          fileName.textContent = this.files[0].name;
          info.style.display = 'flex';
        }
      });

      // Initial preview
      updatePreview();
    });

    // Global function for removing image
    function removeImage() {
      const input = document.getElementById('imageInput');
      const fileNameSpan = document.getElementById('imageFileName');
      const removeBtn = document.getElementById('removeImageBtn');
      
      input.value = '';
      fileNameSpan.textContent = '';
      removeBtn.style.display = 'none';
    }

    // Wait for the DOM to load
    document.addEventListener("DOMContentLoaded", function () {
      /* --- Desmos Calculator Initialization --- */
      var calculatorContainer = document.getElementById("calculator");
      var calculator;
      // Dynamically load the Desmos API script
      var desmosScript = document.createElement("script");
      desmosScript.src = "https://www.desmos.com/api/v1.7/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6";
      desmosScript.async = true;
      desmosScript.onload = function () {
        calculator = Desmos.GraphingCalculator(calculatorContainer, {
          expressions: true,
          settingsMenu: true,
          zoomButtons: true,
          lockViewport: false,
          expressionsTopbar: true,
          keypad: true,
          graphpaper: true,
          administerSecretFolders: true,
          folders: true,
          notes: true,
          pasteGraphLink: true,
          pointsOfInterest: true,
          trace: true,
          borders: true,
          labels: true,
          tips: true,
          qwertyKeyboard: true,
          restrictedFunctions: false,
          restrictGrids: false,
          authorFeatures: true,
        });
        // Observe changes in the calculator state
        calculator.observeEvent("change", function () {
          var state = calculator.getState();
          console.log("Calculator state updated:", state);
        });
      };
      document.body.appendChild(desmosScript);

      /* --- Image Upload Logic --- */
      document.getElementById('imageInput').addEventListener('change', function(e) {
        const fileNameSpan = document.getElementById('imageFileName');
        const removeBtn = document.getElementById('removeImageBtn');
        
        if (this.files && this.files[0]) {
          const fileName = this.files[0].name;
          fileNameSpan.textContent = fileName;
          removeBtn.style.display = 'inline';
        }
      });

      document.getElementById('removeImageBtn').addEventListener('click', removeImage);

      /* --- Rating Stars Logic --- */
      var stars = document.querySelectorAll(".star");
      var ratingValue = 0;
      var hoverRating = 0;

      stars.forEach(function (star, index) {
        star.addEventListener("mouseenter", function () {
          hoverRating = index + 1;
          updateStars();
        });
        star.addEventListener("mouseleave", function () {
          hoverRating = ratingValue;
          updateStars();
        });
        star.addEventListener("click", function () {
          ratingValue = index + 1;
          hoverRating = ratingValue;
          updateStars();
          console.log("Rating selected:", ratingValue);
        });
      });

      function updateStars() {
        stars.forEach(function (star, index) {
          if (index < hoverRating) {
            star.classList.add("rated");
          } else {
            star.classList.remove("rated");
          }
        });
      }

      /* --- Open Question Switch --- */
      var openQuestionSwitch = document.getElementById("openQuestionSwitch");
      var openAnswerSection = document.getElementById("openAnswerSection");
      var multipleChoiceSection = document.getElementById("multipleChoiceSection");

      // Set initial state
      if (openQuestionSwitch.checked) {
        openAnswerSection.style.display = "block";
        multipleChoiceSection.style.display = "none";
      } else {
        openAnswerSection.style.display = "none";
        multipleChoiceSection.style.display = "block";
      }

      openQuestionSwitch.addEventListener("change", function () {
        if (this.checked) {
          openAnswerSection.style.display = "block";
          multipleChoiceSection.style.display = "none";
        } else {
          openAnswerSection.style.display = "none";
          multipleChoiceSection.style.display = "block";
        }
      });

      /* --- Send for Review Button --- */
      const TELEGRAM_BOT_TOKEN = "7937788978:AAEq3rNdQpA0YLF4Vlqn0tnosRGTWLu3qQ0";
      const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}`;
      const CHAT_ID = "-1002253341086"; // Group chat ID without topic

      // Function to generate a random ID
      function generateRandomId(length = 8) {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
          result += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return result;
      }

      // Function to create structured text message
      function createStructuredMessage(data) {
        const isOpenQuestion = document.getElementById("openQuestionSwitch").checked;
        const questionType = isOpenQuestion ? "Open Question" : "Multiple Choice";
        const stars = "⭐".repeat(data.rating || 0);
        
        let answersText = "";
        if (isOpenQuestion) {
          answersText = `Main Answer: ${data.answers[0] || 'Not provided'}\nAlternative Answers: ${data.answers.slice(1).join(', ') || 'None'}`;
        } else {
          answersText = Object.entries(data.answers)
            .map(([key, value], index) => `${String.fromCharCode(65 + index)}. ${value}`)
            .join('\n');
        }

        return `#Question ${data.uniqueId}

📌 *Question:*
${data.question}

${questionType} about ${data.topic || 'Not specified'}
Difficulty: ${data.difficulty || 'Not specified'}
Thought out to ${stars || '0'} stars
🖼️ Image: ${data.image ? "Uploaded" : "Not uploaded"}

📍 *Answers:*
${answersText}

✅ *Correct Answer:* ${data.correctAnswer || 'Not specified'}

📝 *Explanation:*
${data.explanation}`;
      }

      async function prepareFormData() {
        const isOpenQuestion = document.getElementById("openQuestionSwitch").checked;
        const uniqueId = generateRandomId();
        
        let answers;
        if (isOpenQuestion) {
          const mainAnswer = document.querySelector("#openAnswerSection .open-answer:first-child textarea")?.value?.trim();
          const alternativeAnswers = document.querySelector("#openAnswerSection .open-answer:last-child textarea")?.value?.trim();
          answers = [mainAnswer];
          if (alternativeAnswers) {
            answers = answers.concat(alternativeAnswers.split('\n').map(a => a.trim()).filter(a => a));
          }
        } else {
          answers = {};
          document.querySelectorAll(".answer-option input[type='text']").forEach((input, index) => {
            const letter = String.fromCharCode(65 + index);
            answers[letter] = input.value.trim();
          });
        }

        const data = {
          uniqueId,
          question: document.getElementById("question").value.trim(),
          explanation: document.getElementById("explanation").value.trim(),
          answers,
          correctAnswer: isOpenQuestion ? answers[0] : document.querySelector('input[name="correctAnswer"]:checked')?.value,
          topic: document.getElementById("topicSelect").value,
          rating: getRating(),
          difficulty: getDifficulty(),
          image: document.getElementById("imageInput").files[0],
          explanationImage: document.getElementById("explanationImageInput").files[0],
          timestamp: new Date().toISOString()
        };

        return data;
      }

      document.getElementById("sendForReview").addEventListener("click", async function() {
        try {
          if (!await validateForm()) {
            return;
          }

          const data = await prepareFormData();
          
          // First send the structured text message
          const structuredMessage = createStructuredMessage(data);
          const messageData = {
            chat_id: CHAT_ID,
            text: structuredMessage,
            parse_mode: "Markdown",
          };

          const messageResponse = await fetch(`${TELEGRAM_API_URL}/sendMessage`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(messageData),
          });

          if (!messageResponse.ok) {
            throw new Error("Failed to send message to Telegram");
          }

          // If there's a question image, send it
          if (data.image) {
            const imageFormData = new FormData();
            imageFormData.append("photo", data.image);
            imageFormData.append("chat_id", CHAT_ID);
            imageFormData.append("caption", `📸 Question Image for #${data.uniqueId}`);

            const imageResponse = await fetch(`${TELEGRAM_API_URL}/sendPhoto`, {
              method: "POST",
              body: imageFormData
            });

            if (!imageResponse.ok) {
              throw new Error("Failed to send image to Telegram");
            }
          }

          // If there's an explanation image, send it
          if (data.explanationImage) {
            const explanationImageFormData = new FormData();
            explanationImageFormData.append("photo", data.explanationImage);
            explanationImageFormData.append("chat_id", CHAT_ID);
            explanationImageFormData.append("caption", `📸 Explanation Image for Question #${data.uniqueId}\n\n*Explanation text:*\n${data.explanation}`);

            const explanationImageResponse = await fetch(`${TELEGRAM_API_URL}/sendPhoto`, {
              method: "POST",
              body: explanationImageFormData
            });

            if (!explanationImageResponse.ok) {
              throw new Error("Failed to send explanation image to Telegram");
            }
          }

          // Create and download JSON file
          const jsonBlob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
          const url = URL.createObjectURL(jsonBlob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `question_${data.uniqueId}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          alert("Question has been sent for review successfully!");
        } catch (error) {
          console.error("Error:", error);
          alert(`Error: ${error.message}`);
        }
      });

      async function validateForm() {
        const question = document.getElementById("question").value.trim();
        const explanation = document.getElementById("explanation").value.trim();
        const topic = document.getElementById("topicSelect").value;
        const difficulty = getDifficulty();
        
        if (!question) {
          alert("Please enter a question");
          return false;
        }

        if (!explanation) {
          alert("Please provide an explanation");
          return false;
        }

        if (!topic) {
          alert("Please select a topic");
          return false;
        }

        if (!difficulty) {
          alert("Please select a difficulty level");
          return false;
        }

        const isOpenQuestion = document.getElementById("openQuestionSwitch").checked;
        
        if (!isOpenQuestion) {
          // Validate multiple choice
          const options = document.querySelectorAll(".answer-option input[type='text']");
          let hasEmptyOption = false;
          options.forEach(option => {
            if (!option.value.trim()) {
              hasEmptyOption = true;
            }
          });

          if (hasEmptyOption) {
            alert("Please fill in all answer options");
            return false;
          }

          const correctAnswer = document.querySelector('input[name="correctAnswer"]:checked');
          if (!correctAnswer) {
            alert("Please select the correct answer");
            return false;
          }
        } else {
          // Validate open answer
          const mainAnswer = document.querySelector("#openAnswerSection .open-answer:first-child textarea").value.trim();
          if (!mainAnswer) {
            alert("Please provide the main answer");
            return false;
          }
        }

        return true;
      }

      function getRating() {
        const stars = document.querySelectorAll(".star");
        let rating = 0;
        stars.forEach((star, index) => {
          if (star.classList.contains("rated")) {
            rating = index + 1;
          }
        });
        return rating;
      }

      function getDifficulty() {
        const difficultyButtons = document.querySelectorAll(".difficulty-btn");
        let difficulty = null;
        difficultyButtons.forEach(button => {
          if (button.classList.contains("selected")) {
            difficulty = button.textContent.toLowerCase();
          }
        });
        return difficulty;
      }
    });
  </script>
</body>
</html>